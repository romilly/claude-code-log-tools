# Progress Report - 2026-02-15

## Goal
Make log imports idempotent so the notebook can be re-run safely to pick up new and extended sessions without duplicating data.

## Completed

### 1. Idempotent import via timestamp tracking
Added an `import_metadata` table that stores the last import timestamp per project. On re-import, only JSONL entries with timestamps after the cutoff are processed. A unique partial index on `messages.uuid` provides a safety net against duplicates.

### 2. Session summaries
`summary` entries (session titles) are now captured and stored in a new `summary` column on the `sessions` table.

### 3. Entry filtering
- `file-history-snapshot` entries are skipped entirely (no useful content)
- `summary` entries are processed for metadata but not inserted as messages

### 4. Schema migration support
Added `MIGRATION_SQL` block so existing databases get the new columns and tables via `ALTER TABLE ... ADD COLUMN IF NOT EXISTS` and `CREATE TABLE IF NOT EXISTS`.

### 5. Quieter import output
`import_all_logs` now only prints per-file output when there are new messages or errors. Reports total skipped entries.

## Verification
- Fresh import (tables dropped): 30,228 messages, 23,748 blocks, 0 errors
- Second run: 0 new messages from static files; only the active session log picked up genuinely new entries
- Third run: same result, confirming idempotency

## Stats after clean import
- 99 sessions (16 with summaries)
- 30,228 messages
- 23,748 content blocks (7,234 tool_use, 7,230 tool_result, 4,732 thinking, 4,552 text)
- 86 tracked projects

## Files changed
- `notebooks/01_import_logs.ipynb` — schema, import functions, reporting, stats
- `src/claude_code_log_tools/schema.py` — kept in sync with notebook schema

## Next Steps
1. Update `docs/DESIGN.md` to reflect new tables and columns
2. Experiment with queries to find failure patterns
3. Extract import logic to proper modules with hexagonal architecture and TDD
